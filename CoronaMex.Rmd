---
title: 'Coronavirus en Mexico'
output:
  flexdashboard::flex_dashboard:
    vertical_layout: scroll


---
  
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  fig.align = 'center',
  fig.width = 12,
  fig.height = 8
  )

library(tidyverse)
library(flexdashboard)
library(devtools)
install_github('RamiKrispin/coronavirus', force = TRUE)
library(coronavirus)
library(scales)
update_dataset(silence = TRUE)
data(coronavirus)

df <- coronavirus %>%
  filter(country == 'Mexico') %>%
  filter(date > '2020-02-26') %>%
  
  group_by(country, type) %>%
  summarise(total = sum(cases)) %>%
  pivot_wider(
    names_from = type,
    values_from = total
  ) %>%
  mutate(unrecovered = confirmed - ifelse(is.na(death), 0, death)) %>%
  arrange(-confirmed) %>%
  ungroup()

df_daily <- coronavirus %>%
  filter(country == 'Mexico') %>%
  filter(date > '2020-02-26') %>%
  group_by(date, type) %>%
  summarise(total = sum(cases, na.rm = TRUE)) %>%
  pivot_wider(
    names_from = type,
    values_from = total
  ) %>%
  arrange(date) %>%
  ungroup() %>%
  mutate(active = confirmed - death) %>%
  mutate(
    confirmed_cum = cumsum(confirmed),
    death_cum = cumsum(death),
    death_cum_per = death_cum / confirmed_cum * 100,
    active_cum = cumsum(active)
  )

daily_confirmed <- coronavirus %>%
  filter(type == 'confirmed') %>%
  filter(date >= '2020-02-27') %>%
  mutate(country = country) %>%
  group_by(date, country) %>%
  summarise(total = sum(cases)) %>%
  ungroup() %>%
  pivot_wider(names_from = country, values_from = total)

daily_death <- coronavirus %>%
  filter(type == 'death') %>%
  filter(date >= '2020-03-18') %>%
  mutate(country = country) %>%
  group_by(date, country) %>%
  summarise(total = sum(cases)) %>%
  ungroup() %>%
  pivot_wider(names_from = country, values_from = total)
```

Casos confirmados
=======================================================================
  
Column
-----------------------------------------------------------------------
  
### **Casos acumulados en Mexico**
  
```{r}
df_daily %>%
  ggplot(aes(date, confirmed_cum/1000)) + 
  geom_line() +
  geom_smooth() +
  scale_y_continuous(breaks = seq(0, 150, 10)) +
  labs(x = 'Fecha',
       y = 'Numero acumulado de casos (miles)') +
  theme_linedraw()
```

### **Nuevos casos diarios**
  
```{r}
daily_confirmed %>%
  ggplot(aes(date, Mexico/1000)) +
  geom_line() +
  geom_smooth() +
  scale_y_continuous(breaks = seq(0, 10, 1)) +
  labs(x = 'Fecha',
       y = 'Nuevos casos diarios (miles)') +
  theme_linedraw()  
```

Muertes acumuladas
=======================================================================
  
Column
-----------------------------------------------------------------------
  
### **Muertes acumuladas en Mexico**
  
```{r}
df_daily %>%
  ggplot(aes(date, death_cum/1000)) + 
  geom_line() +
  geom_smooth() +
  scale_y_continuous(breaks = seq(0, 15, 1)) +
  labs(x = 'Fecha',
       y = 'Numero acumulado de muertes (miles)') +
  theme_linedraw()
```


### **Nuevas muertes diarias**
  
```{r}
daily_death %>%
  ggplot(aes(date, Mexico/100)) +
  geom_line() +
  geom_smooth() +
  scale_y_continuous(breaks = seq(0, 15, 1)) +
  labs(x = 'Fecha',
       y = 'Nuevas muertes diarias (cientos)') +
  theme_linedraw()  
```
  
  
Tasa de muertes/caso
=======================================================================
  
Column
-------------------------------------
  
### **Tasa de muertes (%)**
  
```{r}
df_daily %>%
  ggplot(aes(date, death_cum_per)) +
  geom_line() +
  geom_smooth() +
  scale_y_continuous(breaks = seq(0, 15, 1)) +
  labs(x = 'Fecha',
       y = 'Tasa de muertes (%)') +
  theme_linedraw()
```


Resumen y fuentes
=======================================================================

Column
-----------------------------------------------------------------------
  
### confirmed {.value-box}

```{r}

valueBox(
  value = paste(format(sum(df$confirmed), big.mark = ','), '', sep = ' '),
  caption = 'Casos totales confirmados [Primer caso: 27 de Febrero]',
  color = 'steelblue'
)
```


### death {.value-box}

```{r}

valueBox(
  value = paste(format(sum(df$death, na.rm = TRUE), big.mark = ','), ' (',
                round(100 * sum(df$death, na.rm = TRUE) / sum(df$confirmed), 1),
                '%)',
                sep = ''
  ),
  caption = 'Muertes (tasa) [Primera muerte: 18 de Marzo]',
  color = 'darkred'
)
```



Column
-------------------------------------

Autor: Jorge Ortega

**Codigo**
  
Disponible en [GitHub](https://github.com/jisaaco/corona/blob/master/CoronaMex.Rmd){target='_blank'}.

**Datos sobre el coronavirus**
  
Disponibles en [`{coronavirus}`](https://github.com/RamiKrispin/coronavirus){target='_blank'}.

Datos crudos del Johns Hopkins University Center for Systems Science and Engineering (JHU CCSE) Coronavirus [repository](https://github.com/RamiKrispin/coronavirus-csv){target='_blank'}.
