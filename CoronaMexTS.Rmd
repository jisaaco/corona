---
title: 'Coronavirus en Mexico (Series de Tiempo)'
output:
  flexdashboard::flex_dashboard:
    vertical_layout: scroll

---
  
```{r setup, include = FALSE}
knitr::opts_chunk$set(
  fig.align = 'center',
  fig.width = 12,
  fig.height = 8
  )

library(tidyverse)
library(tsibble)
library(feasts)
library(fable)
library(flexdashboard)
library(devtools)
install_github('RamiKrispin/coronavirus', force = TRUE)
library(coronavirus)
update_dataset(silence = TRUE)
data(coronavirus)

df_daily <- coronavirus %>%
  filter(country == 'Mexico') %>%
  filter(date > '2020-02-26') %>%
  group_by(date, type) %>%
  summarise(total = sum(cases, na.rm = TRUE)) %>%
  pivot_wider(
    names_from = type,
    values_from = total
  ) %>%
  arrange(date) %>%
  ungroup() %>%
  mutate(active = confirmed - death) %>%
  mutate(
    confirmed_cum = cumsum(confirmed),
    death_cum = cumsum(death),
    death_cum_per = death_cum / confirmed_cum * 100,
    active_cum = cumsum(active)
  ) %>%
  as_tsibble(index = date)
```


Casos confirmados
=======================================================================
  
Column
-----------------------------------------------------------------------
  
```{r casos decompose}
df_daily %>%
  model(STL(confirmed ~ season(period = 7))) %>%
  components() %>%
  autoplot() +
  xlab('Fecha') +
  ylab('Nuevos casos') +
  ggtitle(
    'Casos confirmados diarios (componentes)',
    subtitle = ''
    ) +
  theme_linedraw()
```

```{r casos forecast}
df_daily %>%
  model(arima = ARIMA(confirmed)) %>%
  forecast() %>%
  autoplot(
    filter(
      df_daily,
      date > '2020-02-26'
      )) +
  xlab('Semana') +
  ylab('Nuevos casos') +
  ggtitle('Casos confirmados diarios (predicciones)') +
  theme_linedraw()
```


Muertes
=======================================================================
  
Column
-----------------------------------------------------------------------

```{r muertes decompose}
df_daily %>%
  model(STL(death ~ season(period = 7))) %>%
  components() %>%
  autoplot() +
  xlab('Fecha') +
  ylab('Muertes') +
  ggtitle(
    'Muertes diarias (componentes)',
    subtitle = ''
    ) +
  theme_linedraw()
```

```{r muestres forecast}
df_daily %>%
  model(arima = ARIMA(death)) %>%
  forecast() %>%
  autoplot(
    filter(
      df_daily,
      date > '2020-03-17'
      )) +
  xlab('Semana') +
  ylab('Muertes') +
  ggtitle('Muertes diarias (predicciones)') +
  theme_linedraw()
```

CÃ³digo y fuentes
=======================================================================

Column
-----------------------------------------------------------------------

Autor: Jorge Ortega

**Codigo**
  
Disponible en [GitHub](https://github.com/jisaaco/corona/blob/master/CoronaMexTS.Rmd){target='_blank'}.

**Datos sobre el coronavirus**
  
Disponibles en [`{coronavirus}`](https://github.com/RamiKrispin/coronavirus){target='_blank'}.

Datos crudos del Johns Hopkins University Center for Systems Science and Engineering (JHU CCSE) Coronavirus [repository](https://github.com/RamiKrispin/coronavirus-csv){target='_blank'}.
